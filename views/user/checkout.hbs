<!DOCTYPE HTML>
<html>

<head>
</head>

<body>

    <div class="colorlib-loader"></div>

    <div id="page">
        <nav class="colorlib-nav" role="navigation">
            <div class="top-menu">
            </div>
            <div class="sale">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-8 offset-sm-2 text-center">
                            <div class="row">
                                <div class="owl-carousel2">
                                    <div class="item">
                                        <div class="col">
                                            <h3><a href="#">25% off (Almost) Everything! Use Code: Summer Sale</a></h3>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <div class="col">
                                            <h3><a href="#">Our biggest sale yet 50% off all summer shoes</a></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="colorlib-product">
            <div class="container">
                <div class="row row-pb-lg">
                    <div class="col-sm-10 offset-md-1">
                        <div class="process-wrap">
                            <div class="process text-center active">
                                <p><span>01</span></p>
                                <h3>Shopping Cart</h3>
                            </div>
                            <div class="process text-center active">
                                <p><span>02</span></p>
                                <h3>Checkout</h3>
                            </div>
                            <div class="process text-center">
                                <p><span>03</span></p>
                                <h3>Order Complete</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <form action="" method="post" id="checkoutForm">
                    <div class="row">
                        <div class="col-lg-8">
                            {{!-- <form method="post" id="bbb" class="colorlib-form"> --}}
                                <h2>Billing Details</h2>
                                <div class="row">
                                    {{!-- <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="country">Select Country</label>
                                            <div class="form-field">
                                                <i class="icon icon-arrow-down3"></i>
                                                <select name="people" id="people" class="form-control">
                                                    <option value="#">Select country</option>
                                                    <option value="#">india</option>
                                                    <option value="#">China</option>
                                                    <option value="#">Japan</option>
                                                    <option value="#">Korea</option>
                                                    <option value="#">Philippines</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div> --}}
                                    {{#each userAddress}}


                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="fname">First Name</label>
                                            <input type="text" id="fname" class="form-control" value="{{this.fname}}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="lname">Last Name</label>
                                            <input type="text" id="lname" class="form-control" value="{{this.lname}}">
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="fname">Address</label>
                                            <input type="text" id="address" class="form-control"
                                                value="{{this.address}}">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="Phone">Phone Number</label>
                                            <input type="text" id="zippostalcode" class="form-control"
                                                value="{{this.mobile}}">
                                        </div>
                                        <div>
                                            <label for="Phone">Pincode</label>
                                            <input type="text" id="zippostalcode" class="form-control"
                                                value="{{this.pincode}}">
                                            <br>
                                            {{!-- // <input type="text" name="addressId" value="{{this._id}}" hidden>
                                            --}}
                                            <label for="">Select</label>
                                            <input type="radio" name="addressId" value="{{this._id}}">
                                            <hr>
                                        </div>
                                    </div>
                                    <hr style=" border: 1px solid red" class="">
                                    {{/each}}
                                </div>
                                {{!--
                            </form> --}}
                        </div>

                        <div class="col-lg-4">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="cart-detail">
                                        <h2>Cart Total</h2>
                                        <ul>
                                            <li>
                                                <span>Total</span> <span>{{total}}</span>
                                                {{!-- <ul>
                                                    <li><span>1 x Product Name</span> <span>$99.00</span></li>
                                                    <li><span>1 x Product Name</span> <span>$78.00</span></li>
                                                </ul> --}}
                                            </li>
                                            {{!-- <li><span>Shipping</span> <span>$0.00</span></li>
                                            <li><span>Order Total</span> <span>$180.00</span></li> --}}
                                        </ul>
                                    </div>
                                </div>

                                <div class="w-100"></div>

                                <div class="col-md-12">
                                    <div class="cart-detail">
                                        <h2>Payment Method</h2>

                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="radio">
                                                    <label><input type="radio" value="COD" name="paymentMethod">
                                                        COD</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="radio">
                                                    <label><input type="radio" value="ONLINE" name="paymentMethod">
                                                        Online
                                                        Payment</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <div class="checkbox">
                                                    <label><input type="checkbox" value=""> I have read and accept the
                                                        terms
                                                        and conditions</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <button href="" type="submit" class="btn btn-primary">Checkout</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <footer id="colorlib-footer" role="contentinfo">
            <div class="container">
                <div class="row row-pb-md">
                    <div class="col footer-col colorlib-widget">
                        <h4>About Footwear</h4>
                        <p>Even the all-powerful Pointing has no control about the blind texts it is an almost
                            unorthographic life</p>
                        <p>
                        <ul class="colorlib-social-icons">
                            <li><a href="#"><i class="icon-twitter"></i></a></li>
                            <li><a href="#"><i class="icon-facebook"></i></a></li>
                            <li><a href="#"><i class="icon-linkedin"></i></a></li>
                            <li><a href="#"><i class="icon-dribbble"></i></a></li>
                        </ul>
                        </p>
                    </div>
                    <div class="col footer-col colorlib-widget">
                        <h4>Customer Care</h4>
                        <p>
                        <ul class="colorlib-footer-links">
                            <li><a href="#">Contact</a></li>
                            <li><a href="#">Returns/Exchange</a></li>
                            <li><a href="#">Gift Voucher</a></li>
                            <li><a href="#">Wishlist</a></li>
                            <li><a href="#">Special</a></li>
                            <li><a href="#">Customer Services</a></li>
                            <li><a href="#">Site maps</a></li>
                        </ul>
                        </p>
                    </div>
                    <div class="col footer-col colorlib-widget">
                        <h4>Information</h4>
                        <p>
                        <ul class="colorlib-footer-links">
                            <li><a href="#">About us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Support</a></li>
                            <li><a href="#">Order Tracking</a></li>
                        </ul>
                        </p>
                    </div>

                    <div class="col footer-col">
                        <h4>News</h4>
                        <ul class="colorlib-footer-links">
                            <li><a href="blog.html">Blog</a></li>
                            <li><a href="#">Press</a></li>
                            <li><a href="#">Exhibitions</a></li>
                        </ul>
                    </div>

                    <div class="col footer-col">
                        <h4>Contact Information</h4>
                        <ul class="colorlib-footer-links">
                            <li>291 South 21th Street, <br> Suite 721 New York NY 10016</li>
                            <li><a href="tel://1234567920">+ 1235 2355 98</a></li>
                            <li><a href="mailto:info@yoursite.com">info@yoursite.com</a></li>
                            <li><a href="#">yoursite.com</a></li>
                        </ul>
                    </div>
                </div>
            </div>

        </footer>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <script>
        $("#checkoutForm").submit((e) => {
            e.preventDefault()
            $.ajax({
                url: '/placeOrder',
                method: 'post',
                data: $('#checkoutForm').serialize(),
                success: (response) => {

                    if (response.codeSuccess) {
                        location.href = '/orderPlaced'
                    } else {
                        razorPayPayment(response)
                    }
                }
            })


        })
        function razorPayPayment(order) {
            var options = {
                "key": "rzp_test_doyMHKI06FzLzC", // Enter the Key ID generated from the Dashboard
                "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "shoCart",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response) {

                    verifyPayment(response, order)
                },
                "prefill": {
                    "name": "Gaurav Kumar",
                    "email": "gaurav.kumar@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                }
            }
            var rzp1 = new Razorpay(options)
            rzp1.open()
        }
        function verifyPayment(Payment, order) {
            $.ajax({
                url: '/verify-Payment',
                data: {
                    Payment,
                    order
                },
                method: 'post',
                success: (response) => {
                    if (response.status) {
                        location.href = '/orderPlaced'
                    } else {
                        alert('payment failed')
                    }
                }
            })
        }
    </script>
</body>

</html>

<style>
    .error {
        color: rgb(253, 5, 5);
    }
</style>
<script>

    $("#checkoutForm").validate({


        rules: {
            fname: {
                required: true,
                minlength: 5
            },
            lname: {
                required: true,
                minlength: 2
            },
            address: {
                required: true,
                minlength: 4
            },
            mobile: {
                required: true,
                minlength: 10
            },
            pincode: {
                required: true,
                minlength: 4
            }
        },
        messages: {
            fname: {
                required: 'enter your first name'

            },
            lname: {
                required: 'enter your last name'
            },
            address: {
                required: 'required'

            },
            mobile: {
                required: 'enter your number'

            },
            pincode: {
                required: 'required'
            }

        }
    })


</script>